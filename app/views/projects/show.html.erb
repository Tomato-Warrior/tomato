<div class="wrap">

  <div class="show-data">
    <div class="data">
      <h1 class="tomato-num"><%= @tictac_count %></h1>
      <p>收集番茄</p>
    </div>
    <div class="data">
      <h1 class="doing-task-num"><%= @undo_tasks.count %></h1>
      <p>待完成任務</p>
    </div>
    <div class="data">
      <h1 class="done-data-num"><%= @done_tasks.count %></h1>
      <p>已完成任務</p>
    </div>
  </div>
  
  <%= form_for @task, url: project_tasks_path(@project) do |f| %>
    <% if @task.errors.any? %>
      <ul>
        <% @task.errors.full_messages.each do |message|%>
          <li><%= message %></li>
        <% end %>
      </ul>
    <% end %>

    <div class="add_task">
      <div class="input-group mb-3">
        <%= f.text_field :task_name, class: 'form-control', placeholder: " + 建立任務給自己一個目標吧 ! " %>
        <input type="hidden" value=<%= params[:id] %> id= "task_project_id" name= "task[project_id]">
        <div class="input-group-append">
          <%= f.submit "", class: "btn btn-outline-secondary" %>
        </div>
      </div>
    </div>
  <% end %>

  <div>
    <div class="project_cover d-flex align-items-center pl-3">
      <div id="project_cover" class="project_color" style="background-color:<%= @project.project_cover %>"></div>
      <h2 class="py-2 project-title"> <%= @project.project_name %> </h2>
    </div>
    <ul class="project_task_container">
      <div data-controller="drag" data-id="<%= @project.id %>" data-target="drag.project_id">
        <% @undo_tasks.order(position: :asc).each do |task| %>
          <li class="row p-2 task-hover project-task-list my-2 d-flex" data-id="<%= task.id %>">
            <div class="col-1 d-flex">
                <%= link_to toggle_status_project_task_path(task.project_id, task.id), method: 'patch', class: "pl-3 play-icon" do %>
                  <i class="far fa-circle"></i>
                <% end %>
                <%= link_to task_tictac_path(task_id: task.id), class: "px-3 play-icon" do %>
                  <i class="far fa-play-circle"></i>
                <% end %>
            </div>
            <div class="col-2 align-items-center text-center">
              <%= link_to task.task_name, project_task_path(task.project_id, task.id), class: "list-font" %>
            </div>
            <div class="col-2 d-flex align-items-center">
              <%= display_expect_tictac task.tomato_num %>
              <%= display_finished_tictac task.tictacs.where(status: 'finished').count %>
              <%= display_cancelled_tictac task.tictacs.where(status: 'cancelled').count %>
            </div>
            <div class="col-2 d-flex align-items-center">
              <small class="pr-2">已完成時鐘: <%= task.tictacs.where(status: 'finished').count %></small>
              <small>取消時鐘: <%= task.tictacs.where(status: 'cancelled').count %></small>
            </div>
            <div class="col-3 d-flex align-items-center">
              <%= display_tag task.tag_items %>
            </div>
            <div class="col-1 d-flex align-items-center">
              <%= link_to edit_project_task_path(task.project_id, task.id) do %>
                <i class="fas fa-pencil-alt"></i>
              <% end %>  
            </div>
            <div class="col-1 d-flex align-items-center">
              <%= link_to project_task_path(task.project_id, task.id), method:'delete', data: {confirm: '真的要刪除喵?'} do %>
                <i class="fas fa-trash-alt"></i>
              <% end %>
            </div>
          </li>
        <% end %>
      </div>
    </ul>
  </div>

  <div class="d-flex justify-content-center">  
    <button class="btn done-task" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
      <i class="fas fa-caret-down"></i> 顯示已完成任務
    </button>
  </div>
  <div class="collapse" id="collapseExample">
      <ul class="project_task_container">
        <% @done_tasks.order(position: :asc).each do |task| %>
          <li class="row p-2 task-hover project-task-list my-2 d-flex" data-id="<%= task.id %>">
            <div class="col-1 d-flex">
                <%= link_to toggle_status_project_task_path(task.project_id, task.id), method: 'patch', class: "pl-3 play-icon" do %>
                  <i class="far fa-check-circle"></i>
                <% end %>
                <%= link_to task_tictac_path(task_id: task.id), class: "px-3 play-icon" do %>
                  <i class="far fa-play-circle"></i>
                <% end %>
            </div>
            <div class="col-2 align-items-center text-center">
              <%= link_to task.task_name, project_task_path(task.project_id, task.id), class: "list-font" %>
            </div>
            <div class="col-2 d-flex align-items-center">
              <%= display_expect_tictac task.tomato_num %>
              <%= display_finished_tictac task.tictacs.where(status: 'finished').count %>
              <%= display_cancelled_tictac task.tictacs.where(status: 'cancelled').count %>
            </div>
            <div class="col-2 d-flex align-items-center">
              <small class="pr-2">已完成時鐘: <%= task.tictacs.where(status: 'finished').count %></small>
              <small>取消時鐘: <%= task.tictacs.where(status: 'cancelled').count %></small>
            </div>
            <div class="col-3 d-flex align-items-center">
              <%= display_tag task.tag_items %>
            </div>
            <div class="col-1 d-flex align-items-center">
              <%= link_to edit_project_task_path(task.project_id, task.id) do %>
                <i class="fas fa-pencil-alt"></i>
              <% end %>  
            </div>
            <div class="col-1 d-flex align-items-center">
              <%= link_to project_task_path(task.project_id, task.id), method:'delete', data: {confirm: '真的要刪除喵?'} do %>
                <i class="fas fa-trash-alt"></i>
              <% end %>
            </div>
          </li>
        <% end %>
      </ul>
    </div>
  </div>

</div>

<script>
  $('.collapse').collapse('hide')
</script>